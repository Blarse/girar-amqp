<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Коммуникация сборочницы со сторонними сервисами через брокер сообщений RabbitMQ</title>
<meta name="author" content="Егор Игнатов"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/black.css" id="theme"/>

</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h2>Коммуникация сборочницы со сторонними сервисами через брокер сообщений RabbitMQ</h2><br><h3>Егор Игнатов</h3>«Базальт СПО»
</section>
<section id="sec-table-of-contents"><div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#/slide-org7b53409">Доклад</a></li>
<li><a href="#/slide-org1505bf4">Overview</a></li>
<li><a href="#/slide-org5066b09">Сборочница</a></li>
<li><a href="#/slide-orged9824e">RabbitMQ</a></li>
<li><a href="#/slide-orgdd265b5">Сервисы</a></li>
<li><a href="#/slide-orgb448c2f">The End</a></li>
</ul>
</div>
</div>
</section>


<section>
<section id="slide-org7b53409">
<h2 id="org7b53409">Доклад</h2>

<div id="orgd8cecf8" class="figure">
<p><img src="./qr.svg" alt="qr.svg" class="org-svg" width="55%" align="center" />
</p>
</div>

<p>
<a href="https://blarse.github.io/girar-amqp/">https://blarse.github.io/girar-amqp/</a>
</p>

</section>
</section>
<section>
<section id="slide-org1505bf4">
<h2 id="org1505bf4">Overview</h2>
<ul>
<li class="fragment appear">Сборочница (girar)</li>
<li class="fragment appear">Advanced Message Queuing Protocol
<ul class="fragment appear">
<li>организация очередей</li>
<li>маршрутизация сообщений</li>
<li>надежность</li>
<li>безопасность</li>

</ul></li>

</ul>

</section>
</section>
<section>
<section id="slide-org5066b09">
<h2 id="org5066b09">Сборочница</h2>
<p>
bla bla bla
События
</p>
</section>
<section id="slide-orgbdce17a">
<h3 id="orgbdce17a">Изменение в <b>задании</b></h3>
<ul>
<li class="fragment appear"><b>state</b>: смена состояния таска</li>
<li class="fragment appear"><b>delete</b>: удаление таска</li>
<li class="fragment appear"><b>deps</b>: изменение в списке зависимостей</li>
<li class="fragment appear"><b>share</b>: изменение доступа к заданию</li>
<li class="fragment appear"><b>abort</b>: отмена сборки</li>
<li class="fragment appear"><b>progress</b></li>

</ul>




<ul>
<li class="fragment appear"></li>

<li class="fragment appear">Изменение в <b>подзадании</b></li>
<li class="fragment appear">Изменение в <b>ACL</b></li>

</ul>

</section>
<section id="slide-orgb5d9902">
<h3 id="orgb5d9902">Действия на изменения в таске</h3>

</section>
<section id="slide-org930a387">
<h3 id="org930a387">События на изменения в сабтаске</h3>
<ul>
<li class="fragment appear"><b>create</b></li>
<li class="fragment appear"><b>delete</b></li>
<li class="fragment appear"><b>approve/disapprove</b></li>
<li class="fragment appear"><b>progress</b></li>

</ul>

</section>
<section id="slide-org33fe38a">
<h3 id="org33fe38a">Событие <b>progress</b></h3>
<ul>
<li class="fragment appear">поэтапная загрузка таска в базу</li>
<li class="fragment appear">анализ процесса сборки</li>

</ul>

</section>
<section id="slide-org9e15b92">
<h3 id="org9e15b92">gb/gb-build-task-stages</h3>
<div class="org-src-container">

<pre  class="src src-bash"   ><code trim><span style="color: #8b8386;"># </span><span style="color: #8b8386;">prepare changes</span>
gb-task-gen-buildrepo
gb-task-setup-remote
gb-task-copy-packages
gb-task-build-prep
gb-task-build
fail_if_task_abort_requested
gb-x-girar task-make-index-html <span style="color: #ffa07a;">"$id"</span> ||:

gb-x-girar hook-event task update <span style="color: #ffa07a;">"$id"</span> ||:
<span style="color: #00cdcd;">for</span> i<span style="color: #00cdcd;"> in</span> $(<span style="color: #fa8072;">src_nums</span>); <span style="color: #00cdcd;">do</span>
    gb-x-girar hook-event subtask update <span style="color: #ffa07a;">"$id"</span> <span style="color: #ffa07a;">"$i"</span> ||:
<span style="color: #00cdcd;">done</span>

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">run basic tests</span>
gb-task-check-build
gb-task-check-noarch
gb-task-repo-plan

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">gather information about closed bugs and fixed vulns</span>
gb-task-gen-changelog
gb-task-find-closed-bugs
gb-task-find-fixed-vulns

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">generate task and "next" repos</span>
gb-task-gen-task-repo <span style="color: #ffa07a;">"$id"</span>
gb-task-gen-next-repo

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">run expensive tests</span>
gb-task-repo-check-provides
gb-task-repo-unmets
gb-task-repo-elfsym
gb-task-check-install

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">build and test arepo packages</span>
gb-task-arepo

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">run surmountable tests</span>
gb-task-check-girar
gb-task-check-lastchange
gb-task-check-neighbour-version
gb-task-check-acl

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">apply local policy enforcement</span>
gb-task-local-policy

<span style="color: #8b8386;"># </span><span style="color: #8b8386;">save generated "next" repo for commit</span>
gb-task-gen-ci
gb-task-gen-hash
gb-task-save-repo
</code></pre>
</div>

</section>
<section id="slide-org4b94dcd">
<h3 id="org4b94dcd">События на изменения в ACL</h3>
<ul class="fragment appear">
<li>add</li>
<li>del</li>
<li>leader</li>
<li>replace</li>
<li>create</li>
<li>delete</li>

</ul>


</section>
</section>
<section>
<section id="slide-orged9824e">
<h2 id="orged9824e">RabbitMQ</h2>
<p class="fragment (appear)">
blabla
why RabbitMQ?
</p>

</section>
<section id="slide-org81ef27d">
<h3 id="org81ef27d">High Availability</h3>
</section>
<section id="slide-orgf61c089">
<h3 id="orgf61c089">Security</h3>
</section>
<section id="slide-org5682eac">
<h3 id="org5682eac">Routing</h3>


</section>
<section id="slide-orga87af3f">
<h3 id="orga87af3f">routing: routing key(sostav)</h3>

</section>
</section>
<section>
<section id="slide-orgdd265b5">
<h2 id="orgdd265b5">Сервисы</h2>
<div class="outline-text-2" id="text-orgdd265b5">
</div>
</section>
<section id="slide-orgf4883fc">
<h3 id="orgf4883fc">repodb</h3>
<ul>
<li class="fragment appear">altrepodb</li>
<li class="fragment appear">altrepo-api и <a href="https://rdb.altlinux.org/api/">https://rdb.altlinux.org/api/</a></li>
<li class="fragment appear">packages.altlinux.org</li>
<li class="fragment appear">Сервис загрузки тасков</li>

</ul>

</section>
<section id="slide-org697ece2">
<h3 id="org697ece2">bugzilla</h3>
</section>
<section id="slide-orgd1f25c3">
<h3 id="orgd1f25c3">QA automation</h3>
</section>
<section id="slide-org95d9f1e">
<h3 id="org95d9f1e">Future</h3>


</section>
</section>
<section>
<section id="slide-orgb448c2f">
<h2 id="orgb448c2f">The End</h2>
<div class="outline-text-2" id="text-orgb448c2f">
</div>
</section>
<section id="slide-org5a197e1">
<h3 id="org5a197e1">links:</h3>
<p>
<a href="https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol">Wikipedia: AMQP</a>
</p>

<p>
<a href="https://en.wikipedia.org/wiki/RabbitMQ">Wikipedia: RabbitMQ</a>
</p>

<p>
<a href="https://www.rabbitmq.com/documentation.html">RabbitMQ Docs</a>
</p>

</section>
<section id="slide-org287b6c9">
<h3 id="org287b6c9">sources:</h3>
<p>
<a href="https://git.altlinux.org/people/glebfm/packages/girar.git">girar</a>
</p>


<p>
<a href="https://git.altlinux.org/people/dshein/public/?p=altrepodb.git">altrepodb</a>
</p>
</section>
</section>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/markdown/markdown.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>


<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
plugins: [RevealMarkdown, RevealZoom, RevealNotes],
center:false, transition:'slide', hash: true, navigationMode: 'linear',
margin:0.1, width:1024, height:768
});

</script>
</body>
</html>
